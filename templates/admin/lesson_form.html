{% extends "base.html" %}
{% block title %}{{ "Редактировать" if lesson else "Новый" }} урок{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">
    {{ "Редактировать урок" if lesson else "Новый урок" }} — {{ course.title }}
  </h2>

  <form
    action="{{
      '/admin/lessons/' ~ lesson.id ~ '/update'
      if lesson
      else '/admin/courses/' ~ course.id ~ '/lessons/create'
    }}"
    method="post"
    enctype="multipart/form-data"
  >
    <!-- Название урока -->
    <div class="mb-3">
      <label for="title" class="form-label">Название урока</label>
      <input
        type="text"
        name="title"
        id="title"
        class="form-control"
        placeholder="Введите название урока"
        value="{{ lesson.title if lesson else '' }}"
        required
      >
    </div>

    <!-- Текстовый контент урока -->
    <div class="mb-3">
      <label for="text_content" class="form-label">
        Содержимое урока (Markdown поддерживается)
      </label>
      <textarea
        name="text_content"
        id="text_content"
        class="form-control"
        rows="8"
        placeholder="Добавьте текст или разметку урока"
      >{{ lesson.text_content if lesson else '' }}</textarea>
      <div class="form-text">
        Можно использовать Markdown для форматирования текста.
      </div>
    </div>

    <!-- Загрузка видео -->
    <div class="mb-3">
      <label for="video_file" class="form-label">Видео (mp4, webm, ogg)</label>
      <input
        type="file"
        name="video_file"
        id="video_file"
        accept="video/*"
        class="form-control"
      >
      {% if lesson and lesson.video_path %}
        <div class="mt-2">
          <small class="text-muted">
            Текущее видео: {{ lesson.video_path.split('/')[-1] }}
          </small>
        </div>
        <div class="mt-2">
          <video controls width="320">
            <source src="/{{ lesson.video_path }}">
            Ваш браузер не поддерживает видео.
          </video>
        </div>
      {% endif %}
    </div>

    <!-- Кнопки -->
    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary">
        {{ "Сохранить изменения" if lesson else "Создать урок" }}
      </button>
      <a href="/admin/courses/{{ course.id }}/lessons" class="btn btn-secondary">
        Назад к списку уроков
      </a>
    </div>
  </form>
</div>
{% endblock %}
