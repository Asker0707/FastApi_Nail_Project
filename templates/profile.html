{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å | Nailis.hub{% endblock %}

{% block extra_css %}
<style>
  .profile-header {
    background: linear-gradient(135deg, #f7e7de, #fffaf7);
    border-radius: 1.5rem;
    padding: 2rem;
    box-shadow: 0 6px 18px rgba(163, 107, 94, 0.15);
    margin-bottom: 2rem;
    text-align: center;
  }
  .profile-header h2 {
    font-weight: 700;
    color: #7b5a50;
    margin-bottom: 0.3rem;
  }
  .profile-header p {
    color: #a08b7a;
  }
  .profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    margin: 0 auto 1rem;
    background: #fff;
    box-shadow: 0 4px 14px rgba(163, 107, 94, 0.12);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 700;
    color: #a36b5e;
  }
  .stat-card {
    border-radius: 1rem;
    background: #fff;
    padding: 1.5rem;
    box-shadow: 0 4px 14px rgba(163, 107, 94, 0.12);
    text-align: center;
    transition: transform 0.2s ease;
  }
  .stat-card:hover { transform: translateY(-4px); }
  .stat-icon {
    font-size: 2rem;
    color: #a36b5e;
    margin-bottom: 0.5rem;
  }
  .section-title {
    font-weight: 600;
    font-size: 1.5rem;
    color: #7b5a50;
    margin: 2rem 0 1rem;
  }
  .progress-card, .badge-item {
    border-radius: 1rem;
    background: #fff;
    padding: 1rem 1.2rem;
    box-shadow: 0 4px 14px rgba(163, 107, 94, 0.12);
    margin-bottom: 1rem;
    transition: transform 0.2s ease;
  }
  .progress-card:hover, .badge-item:hover {
    transform: translateY(-3px);
  }
  .badge-icon {
    font-size: 2rem;
    color: #a36b5e;
    margin-bottom: 0.4rem;
  }
  .logout-btn {
    display: block;
    margin: 2rem auto 0;
    padding: 0.8rem 2rem;
    border: none;
    border-radius: 0.8rem;
    background: #a36b5e;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .logout-btn:hover {
    background: #7b5a50;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <div id="profile-content">
    <div class="d-flex justify-content-center align-items-center" style="min-height: 50vh;">
      <div class="spinner-border" style="width: 3rem; height: 3rem; color: #a36b5e;" role="status">
        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function loadProfile() {
  const res = await fetch("/api/profile_data", { credentials: "same-origin" });
  if (!res.ok) return window.location.href = "/login";
  const data = await res.json();

  const initials = data.full_name.split(' ').map(n => n[0]).join('').toUpperCase();

  // –£—Ä–æ–∫–∏
  let lastLessonsHTML = "";
  if (data.last_courses?.length) {
    lastLessonsHTML = `
      <h4 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —É—Ä–æ–∫–∏</h4>
      ${data.last_courses.map(lesson => `
        <div class="progress-card">
          <div class="d-flex justify-content-between">
            <span>${lesson.title}</span>
            <small class="text-muted">${lesson.date}</small>
          </div>
        </div>
      `).join("")}
    `;
  }

  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
  let badgesHTML = "";
  if (data.badges?.length) {
    badgesHTML = `
      <h4 class="section-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h4>
      <div class="row g-3">
        ${data.badges.map(b => `
          <div class="col-6 col-md-3">
            <div class="badge-item text-center">
              <div class="badge-icon"><i class="${b.icon}"></i></div>
              <div>${b.name}</div>
            </div>
          </div>
        `).join("")}
      </div>
    `;
  }

  document.getElementById("profile-content").innerHTML = `
    <div class="profile-header">
      <div class="profile-avatar">${initials}</div>
      <h2>${data.full_name}</h2>
      <p>${data.email}</p>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="fs-4 fw-bold">${data.progress_percent}%</div>
          <div class="text-muted">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="fs-4 fw-bold">${data.completed_lessons}</div>
          <div class="text-muted">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card">
          <div class="stat-icon">üìö</div>
          <div class="fs-4 fw-bold">${data.total_lessons}</div>
          <div class="text-muted">–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤</div>
        </div>
      </div>
    </div>

    ${lastLessonsHTML}
    ${badgesHTML}

    <button class="logout-btn" onclick="window.location.href='/auth/logout'">
      <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
    </button>
  `;
}
loadProfile();
</script>
{% endblock %}
